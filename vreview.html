<title>Value aware product review</title>
<meta name="route" content="/url/:url">
<meta name="firebase" content="https://lifestyles.firebaseio.com">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,minimal-ui" />
<link rel="stylesheet" href="vreview.css" type="text/css">
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.7.1/coffee-script.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script type="text/coffeescript" src="space-pen.coffee"></script>
<script src='https://cdn.firebase.com/v0/firebase.js'></script>
<script src='https://cdn.firebase.com/js/simple-login/1.2.3/firebase-simple-login.js'></script>
<script type="text/javascript"> window.onerror = function(x){ alert(x); }; </script>
<script type="text/coffeescript" src="vreview.coffee"></script>
<!--  <script src="batshit.js"></script><script src="vreview.js"></script>  -->
<body></body>
<script type="text/coffeescript" charset="utf-8">


###
# --- todo ---
# m1 - actual live fb version of Rationale; cheats on common tags and userid
# m2 - add in Outcomes, with real firebase updates
# m3 - integrate fb login and URL recognition
# m4 - relate the item, the rationale, and the outcomes, realistically
###




## the basics



class Item extends View
  @content: (inputs) ->
    { item, engagement, tags, followup_info } = inputs
    @div class: 'item', =>
      @img src: item.img
      @h2 item.name
      @subview 'annotation', new Annotation(inputs)



class Annotation extends View
  @content: (inputs) ->
    { item, engagement, tags, followup_info } = inputs
    @div class: 'annotation', =>
      @p =>
        @text "For others, "
        @b engagement.gerund
        @text " this was about..."
      @div =>
        @text "For you?"
        @subview 'rationale', new Rationale(inputs)
        @subview 'outcomes', new Outcomes(inputs)



class Rationale extends View
  @content: (item, engagement, fbref, common_tags) ->
    @section class: 'rationale', =>
      @div class: 'item', =>
        @img src: item.img
        @h2 item.name
      @p class: 'engagement', =>
        @text "What was "
        @b engagement.gerund
        @text " this about?"
      @div class: 'queries', =>
        for tag in common_tags
          [ type, tagname ] = tag.split(': ')
          @div tag: tag, =>
            @h3 tagname
            @p "I wanted this #{type}"
            @button click: 'yes', 'yes'
            @button click: 'no', 'no'
  initialize: (item, engagement, @fbref, common_tags) ->
    true
  yes: (event, element) =>
    obj = {}
    obj[ element.parent().attr 'tag' ] = { intended: true }
    @fbref.update(obj)
    $(element).parent().hide()
  no: (event, element) =>
    obj = {}
    obj[ element.parent().attr 'tag' ] = { intended: false }
    @fbref.update(obj)
    $(element).parent().hide()



class Outcomes extends View
  @content: (@fbref) ->
    @section class: 'outcomes', =>
      @h2 "How has it gone?"
      @div class: 'queries', outlet: 'list', "Loading..."
  initialize: (@fbref) ->
    @sub @fbref, 'value', (snap) =>
      @list.html $$ ->
        for tag, data of snap.val()
          [ type, tagname ] = tag.split(': ')

          switch type
            when 'activity'
              @div =>
                @h3 tagname
                @h4 =>
                  @span "I do this"
                  @b outlet: 'how_often', "weekly"
                @input type: 'range'

            when 'outcome'
              @div =>
                @h3 tagname
                @div "put toggler here - y/n"

            when 'quality'
              @div =>
                @h3 tagname
                @div "put toggler here - y/n"




# spin it up!

batshit.setup_firebase()

$ 'body'
  .append new Rationale
    name: 'vitesse bike'
    img: ''
  ,
    pasttense: 'bought'
    gerund: 'buying'
    ago: '1 month'
  ,
    fb('rationale_test')
  ,
    [
      'activity: distance biking',
      'outcome: getting fit',
      'outcome: feeling relaxed',
      'quality: a bold decision',
    ]

$ 'body'
  .append new Outcomes(fb('rationale_test'))



</script></html>
